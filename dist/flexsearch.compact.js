/**!
 * FlexSearch.js v0.7.0-beta (Compact)
 * Copyright 2019 Nextapps GmbH
 * Author: Thomas Wilkerling
 * Licence: Apache-2.0
 * https://github.com/nextapps-de/flexsearch
 */
(function(self){'use strict';var v;const x=/[\W_]+/;function aa(a){if(a=a.toLowerCase())if(a&&this.A&&(a=y(a,this.A)),this.C&&1<a.length&&(a=y(a,this.C)),a&&(x||""===x)&&(a=a.split(x),this.filter)){var b=this.filter;const c=a.length,e=[];for(let d=0,f=0;d<c;d++){const g=a[d];g&&!b[g]&&(e[f++]=g)}a=e}return a};function z(a,b){return"undefined"!==typeof a?a:b}function A(a){const b=Array(a);for(let c=0;c<a;c++)b[c]=B();return b}function B(){return Object.create(null)}function ba(a,b){return b.length-a.length}function C(a){return"string"===typeof a}function D(a){return"object"===typeof a};function G(a,b){const c=Object.keys(a),e=c.length,d=[];let f="",g=0;for(let h=0,k,l;h<e;h++)k=c[h],(l=a[k])?(d[g++]=new RegExp(b?"(?!\\b)"+k+"(\\b|_)":k,"g"),d[g++]=l):f+=(f?"|":"")+k;f&&(d[g++]=new RegExp(b?"(?!\\b)("+f+")(\\b|_)":"("+f+")","g"),d[g]="");return d}function y(a,b){for(let c=0,e=b.length;c<e&&(a=a.replace(b[c],b[c+1]),a);c+=2);return a};const H={},K={};let ea=Promise;function L(a){M(a,"add");M(a,"append");M(a,"search");M(a,"update");M(a,"remove")}function M(a,b){a[b+"Async"]=function(){const c=this,e=arguments;var d=e[e.length-1];let f;"function"===typeof d&&(f=d,delete e[e.length-1]);d=new ea(function(g){setTimeout(function(){c.async=!0;g(c[b].apply(c,e));c.async=!1})});return f?(d.then(f),this):d}};function N(a,b,c,e){var d=a.length;let f=[],g,h=0;e&&(e=[]);for(--d;0<=d;d--){const k=a[d],l=k.length,n=B();let q=!g;for(let r=0;r<l;r++){const u=k[r],p=u.length;if(p)for(let m=0,t=0,w;m<p;m++)if(w=u[m],!g)n[w]=1;else if(g[w]){if(d)e&&t<b&&((e[r]||(e[r]=[]))[t++]=w),n[w]=1;else if(c)c--;else if(f[h++]=w,h===b)return f;q=!0}}if(!q&&!e)return[];g=n}if(e)for(let k=e.length-1,l,n;0<=k;k--)if((n=(l=e[k])&&l.length)&&c&&(n<=c?(c-=n,n=0):n-=c),n){if(h+n>=b)return f.concat(l.slice(c,b-h+c));f=f.concat(c?
l.slice(c):l);h+=n;c=0}return f}function fa(a,b){const c=B(),e=B(),d=[];for(let f=0;f<a.length;f++)c[a[f]]=1;for(let f=0,g;f<b.length;f++){g=b[f];for(let h=0,k;h<g.length;h++)k=g[h],c[k]&&!e[k]&&(e[k]=1,d[d.length]=k)}return d};const ha={memory:{charset:"latin:extra",m:3,j:3,s:!1,l:"memory"},performance:{threshold:8,j:3,context:{depth:1,v:!0}},match:{charset:"latin:extra",H:"full",m:3},score:{charset:"latin:advanced",threshold:1,context:{depth:3,v:!0}},"default":{m:3,threshold:0,depth:3}};function O(a,b){if(!(this instanceof O))return new O(a);var c;let e;a?(C(a)?a=ha[a]:(c=a.preset)&&(a=Object.assign({},c[c],a)),c=a.charset,e=a.lang,C(c)&&(-1===c.indexOf(":")&&(c+=":default"),c=K[c]),C(e)&&(e=H[e])):a={};let d,f,g,h=a.context||{};this.encode=a.encode||c&&c.encode||aa;this.register=b||B();d=a.resolution||9;f=a.threshold||0;f>=d&&(f=d-1);this.m=d;this.threshold=f;this.u=b=c&&c.H||a.tokenize||"strict";this.depth="strict"===b&&h.depth;this.v=z(h.bidirectional,!0);this.l=g="memory"===
a.optimize;this.s=z(a.fastupdate,!0);this.j=a.minlength||1;this.g=g?A(d-f):B();d=h.resolution||d;f=h.threshold||f;f>=d&&(f=d-1);this.h=d;this.o=f;this.i=g?A(d-f):B();this.B=c&&c.B||a.rtl;this.A=(b=a.matcher||e&&e.A)&&G(b,!1);this.C=(b=a.stemmer||e&&e.C)&&G(b,!0);if(a=b=a.filter||e&&e.filter){a=b;c=B();for(let k=0,l=a.length;k<l;k++)c[a[k]]=1;a=c}this.filter=a}v=O.prototype;v.append=function(a,b){return this.add(a,b,!0)};
v.add=function(a,b,c){if(this.register[a]&&!c)return this.update(a,b);if(b&&(a||0===a)){b=this.encode(b);const l=b.length;if(l){const n=this.depth,q=this.m-this.threshold,r=B(),u=B();for(let p=0;p<l;p++){let m=b[this.B?l-1-p:p];var e=m.length;if(m&&e>=this.j&&(n||!r[m])){var d=Math.min(this.m/l*p|0,p);if(d<q){var f="";switch(this.u){case "full":if(3<e){for(var g=0;g<e;g++){var h=g?Math.min(d/2+this.m/e*g/2|0,d+g):d;if(h<q)for(var k=e;k>g;k--)f=m.substring(g,k),f.length>=this.j&&Q(this,r,f,h,a,c)}break}case "reverse":if(2<
e){for(g=e-1;0<g;g--)f=m[g]+f,f.length>=this.j&&Q(this,r,f,d,a,c);f=""}case "forward":if(1<e)for(g=0;g<e;g++)f+=m[g],f.length>=this.j&&Q(this,r,f,d,a,c);break;default:if(Q(this,r,m,d,a,c),n&&1<l&&p<l-1)for(e=this.h-this.o,d=B(),f=m,g=Math.min(n+1,l-p),d[f]=1,h=1;h<g;h++)if((m=b[this.B?l-1-p-h:p+h])&&m.length>=this.j&&!d[m]){if(d[m]=1,k=Math.min((this.h-g)/l*p+h|0,p+(h-1)),k<e){const t=this.v&&m>f;Q(this,u,t?f:m,k,a,c,t?m:f)}}else g=Math.min(g+1,l-p)}}}}this.s||(this.register[a]=1)}}return this};
function Q(a,b,c,e,d,f,g){let h=g?a.i:a.g;if(!b[c]||g&&!b[c][g])a.l&&(h=h[e]),g?(b=b[c]||(b[c]=B()),b[g]=1,h=h[g]||(h[g]=B())):b[c]=1,h=h[c]||(h[c]=[]),a.l||(h=h[e]||(h[e]=[])),f&&-1!==h.indexOf(d)||(h[h.length]=d,a.s&&(a=a.register[d]||(a.register[d]=[]),a[a.length]=h))}
v.search=function(a,b,c){D(a)?(c=a,a=c.query):D(b)&&(c=b);let e=[],d;var f=this.threshold;let g,h=0;if(c){b=c.limit;h=c.offset||0;f=z(c.threshold,f);var k=c.context;g=c.suggest}if(a&&(a=this.encode(a),d=a.length,1<d)){c=B();var l=[];for(let q=0,r=0,u;q<d;q++)if((u=a[q])&&u.length>=this.j&&!c[u])if(this.l||g||this.g[u])l[r++]=u,c[u]=1;else return e;a=l;d=a.length}if(!d)return e;b||(b=100);c=this.m-f;f=this.h-f;k=this.depth&&1<d&&!1!==k;l=0;let n;k?(n=a[0],l=1):1<d&&a.sort(ba);for(let q,r;l<d;l++){r=
a[l];k?(q=R(this,e,g,f,b,h,2===d,r,n),g&&!1===q&&e.length||(n=r)):q=R(this,e,g,c,b,h,1===d,r);if(q)return q;if(g&&l===d-1){let u=e.length;if(!u){if(k){k=0;l=-1;continue}return e}if(1===u)return ia(e[0],b,h)}}return N(e,b,h,g)};
function R(a,b,c,e,d,f,g,h,k){let l=[],n=k?a.i:a.g;a.l||(n=ja(n,h,k,a.v));if(n){let q=0;e=Math.min(n.length,e);for(let r=0,u=0,p,m;r<e&&!(p=n[r],a.l&&(p=ja(p,h,k,a.v)),p&&g&&(m=p.length,m<=f?(f-=m,p=null):f&&(p=p.slice(f),f=0)),p&&(l[q++]=p,g&&(u+=p.length,u>=d)));r++);if(q){if(g)return ia(l,d,0);b[b.length]=l;return}}return!c&&l}function ia(a,b,c){a=1===a.length?a[0]:[].concat.apply([],a);return c||a.length>b?a.slice(c,c+b):a}
function ja(a,b,c,e){c?(e=e&&b>c,a=(a=a[e?b:c])&&a[e?c:b]):a=a[b];return a}v.contain=function(a){return!!this.register[a]};v.update=function(a,b){return this.remove(a).add(a,b)};v.remove=function(a,b){const c=this.register[a];if(c){if(this.s)for(let e=0,d;e<c.length;e++)d=c[e],d.splice(d.indexOf(a),1);else S(this.g,a,this.m-this.threshold,this.l),this.depth&&S(this.i,a,this.h-this.o,this.l);b||delete this.register[a]}return this};
function S(a,b,c,e,d){let f=0;if(a.constructor===Array)if(d)b=a.indexOf(b),-1!==b?1<a.length&&(a.splice(b,1),f++):f++;else{d=Math.min(a.length,c);for(let g=0,h;g<d;g++)if(h=a[g])f=S(h,b,c,e,d),e||f||delete a[g]}else for(let g in a)(f=S(a[g],b,c,e,d))||delete a[g];return f}L(O.prototype);function T(a){if(!(this instanceof T))return new T(a);var b;a||(a={});this.D=[];this.g=[];this.u=[];this.register=B();this.key=(b=a.key)&&U(b,this.u)||"id";this.s=z(a.fastupdate,!0);this.o=!!(b=a.extern);this.h=!this.o&&(b=a.store)&&!0!==b&&[];this.store=b&&(this.o?b:B());this.async=!1;b=a;a=B();let c=b.doc;if(C(c))c=[c];else if(c.constructor!==Array){var e=c;c=Object.keys(c)}for(let d=0,f,g;d<c.length;d++)f=c[d],C(f)?e&&(g=e[f]):(g=f,f=f.field),g=D(g)?Object.assign({},b,g):b,this.F||(a[f]=new O(g,
this.register)),this.D[d]=U(f,this.u),this.g[d]=f;if(this.h)for(e=b.store,C(e)&&(e=[e]),b=0;b<e.length;b++)this.h[b]=U(e[b],this.u);this.i=a}function U(a,b){const c=a.split(":");let e=0;for(let d=0;d<c.length;d++)a=c[d],0<=a.indexOf("[]")&&(a=a.substring(0,a.length-2))&&(b[e]=!0),a&&(c[e++]=a);e<c.length&&(c.length=e);return 1<e?c:c[0]}
function V(a,b,c,e,d){a=a[d];if(e===c.length-1)b[d]=a;else if(a)if(a.constructor===Array)for(b=b[d]=Array(a.length),d=0;d<a.length;d++)V(a,b,c,e,d);else b=b[d]||(b[d]=B()),d=c[++e],V(a,b,c,e,d)}function W(a,b,c,e,d,f,g,h){a=a[g];if(e===b.length-1){if(a.constructor===Array){if(c[e]){for(b=0;b<a.length;b++)d.add(f,a[b],!0);return}a=a.join(" ")}d.add(f,a,h)}else if(a)if(a.constructor===Array)for(g=0;g<a.length;g++)W(a,b,c,e,d,f,g,h);else g=b[++e],W(a,b,c,e,d,f,g,h)}v=T.prototype;
v.add=function(a,b,c){if(D(a)){a=b=a;var e=this.key;if(C(e))a=a[e];else for(let d=0;a&&d<e.length;d++)a=a[e[d]]}if(b&&(a||0===a)){if(this.register[a])return this.update(a,b);for(let d=0,f,g;d<this.g.length;d++)g=this.g[d],f=this.D[d],C(f)&&(f=[f]),W(b,f,this.u,0,this.i[g],a,f[0],c);if(this.store&&!this.o){let d;if(this.h){d=B();for(let f=0,g;f<this.h.length;f++)g=this.h[f],C(g)?d[g]=b[g]:V(b,d,g,0,g[0])}this.store[a]=d||b}}return this};v.append=function(a,b){return this.add(a,b,!0)};
v.update=function(a,b){return this.remove(a).add(a,b)};v.remove=function(a){D(a)&&(a=a[this.key]);if(this.register[a]){for(let b=0;b<this.g.length&&(this.i[this.g[b]].remove(a,!0),!this.s||this.F);b++);this.store&&!this.o&&delete this.store[a];delete this.register[a]}return this};
v.search=function(a,b,c,e){D(a)?(c=a,a=c.query):D(b)&&(c=b,b=0);let d=[],f=[],g,h,k,l,n,q,r,u=0;if(c)if(c.constructor===Array)k=c,c=null;else if(k=(g=c.pluck)||c.field||c.doc,n=!1,h=this.store&&c.enrich,q="and"===c.bool,b=c.limit||100,r=c.offset||0,k&&(C(k)?k=[k]:k.constructor!==Array&&(l=k,k=Object.keys(k))),n&&(C(n)&&(n=[n]),!a)){for(let m=0,t;m<n.length;m++)if(t=ka.call(this,n[m],b,r,h))d[d.length]=t,u++;return u?d:[]}k||(k=this.g);q=q&&(1<k.length||n&&1<n.length);const p=!e&&(this.F||this.async)&&
[];for(let m=0,t,w,E;m<k.length;m++){let I;w=k[m];C(w)?l&&(I=l[w]):(I=w,w=w.field);if(p)p[m]=this.i[w].searchAsync(a,b,I||c);else{e?t=e[m]:t=this.i[w].search(a,b,I||c);E=t.length;if(n&&E){const F=[];let ca=0;q&&(F[0]=[t]);for(let P=0,da,J;P<n.length;P++)if(da=n[P],E=(J=this.G[da])&&J.length)ca++,F[F.length]=q?[J]:J;ca&&(t=q?N(F,b||100,r||0):fa(t,F),E=t.length)}if(E)f[u]=w,d[u++]=t;else if(q)return[]}}if(p){const m=this;return new Promise(function(t){Promise.all(p).then(function(w){t(m.search(a,b,
c,w))})})}if(!u)return[];if(g&&(!h||!this.store))return d[0];for(let m=0,t;m<f.length;m++){t=d[m];t.length&&h&&(t=la.call(this,t));if(g)return t;d[m]={field:f[m],result:t}}return d};function ka(a,b,c,e){let d=this.G[a],f=d&&d.length-c;if(f&&0<f){if(f>b||c)d=d.slice(c,c+b);e&&(d=la.call(this,d));return{tag:a,result:d}}}function la(a){const b=Array(a.length);for(let c=0,e;c<a.length;c++)e=a[c],b[c]={key:e,doc:this.store[e]};return b}v.contain=function(a){return!!this.register[a]};v.get=function(a){return this.store[a]};
v.set=function(a,b){this.store[a]=b;return this};L(T.prototype);const X=self;let Y;const Z={Index:O,Document:T,Worker:null,registerCharset:function(a,b){K[a]=b},registerLanguage:function(a,b){H[a]=b}};(Y=X.define)&&Y.amd?Y([],function(){return Z}):X.exports?X.exports=Z:X.FlexSearch=Z;}(this));
